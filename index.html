<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>English Speaking Practice</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 800px;
        width: 100%;
        padding: 40px;
        animation: slideIn 0.5s ease-out;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      h1 {
        color: #667eea;
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .subtitle {
        color: #666;
        font-size: 1.1em;
      }

      .welcome-section {
        background: #f0f4ff;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
        border-left: 4px solid #667eea;
      }

      .welcome-section h2 {
        color: #667eea;
        margin-bottom: 10px;
      }

      .welcome-section p {
        color: #555;
        line-height: 1.6;
      }

      .lesson-selector {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .lesson-btn {
        flex: 1;
        min-width: 200px;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .lesson-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
      }

      .lesson-btn.active {
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        box-shadow: 0 6px 20px rgba(46, 204, 113, 0.6);
      }

      .practice-area {
        display: none;
      }

      .practice-area.active {
        display: block;
      }

      .progress-section {
        margin-bottom: 30px;
      }

      .progress-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        color: #666;
        font-weight: 600;
      }

      .progress-bar-container {
        background: #e0e0e0;
        height: 12px;
        border-radius: 10px;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.5s ease;
        border-radius: 10px;
      }

      .question-display {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px;
        border-radius: 15px;
        margin-bottom: 30px;
        text-align: center;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      }

      .question-number {
        font-size: 1em;
        opacity: 0.9;
        margin-bottom: 15px;
      }

      .question-text {
        font-size: 2em;
        font-weight: bold;
        line-height: 1.4;
      }

      .timer-display {
        background: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .timer-label {
        color: #666;
        font-size: 1em;
        margin-bottom: 10px;
      }

      .timer-value {
        font-size: 3em;
        font-weight: bold;
        color: #667eea;
      }

      .timer-value.warning {
        color: #e74c3c;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .status-indicator {
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        margin-bottom: 20px;
        font-weight: 600;
        font-size: 1.1em;
      }

      .status-speaking {
        background: #d4edda;
        color: #155724;
        border: 2px solid #c3e6cb;
      }

      .status-waiting {
        background: #fff3cd;
        color: #856404;
        border: 2px solid #ffeaa7;
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 30px;
      }

      .control-btn {
        padding: 15px 40px;
        font-size: 1.1em;
        font-weight: bold;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }

      .btn-start {
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        color: white;
      }

      .btn-start:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(46, 204, 113, 0.4);
      }

      .btn-pause {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        color: white;
      }

      .btn-pause:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(243, 156, 18, 0.4);
      }

      .btn-stop {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
      }

      .btn-stop:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4);
      }

      .control-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .voice-controls {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .voice-control-group {
        margin-bottom: 15px;
      }

      .voice-control-group:last-child {
        margin-bottom: 0;
      }

      .voice-control-group label {
        display: block;
        color: #555;
        font-weight: 600;
        margin-bottom: 8px;
      }

      .voice-priority-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75em;
        margin-left: 5px;
        font-weight: bold;
      }

      .badge-us {
        background: #2ecc71;
        color: white;
      }

      .badge-uk {
        background: #3498db;
        color: white;
      }

      .badge-other {
        background: #95a5a6;
        color: white;
      }

      .voice-control-group select,
      .voice-control-group input[type="range"] {
        width: 100%;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1em;
      }

      .voice-control-group input[type="range"] {
        padding: 0;
      }

      .completion-message {
        text-align: center;
        padding: 40px;
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        color: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
      }

      .completion-message h2 {
        font-size: 2.5em;
        margin-bottom: 15px;
      }

      .completion-message p {
        font-size: 1.3em;
        margin-bottom: 25px;
      }

      .restart-btn {
        padding: 15px 40px;
        font-size: 1.2em;
        font-weight: bold;
        background: white;
        color: #27ae60;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }

      .restart-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 2em;
        }

        .question-text {
          font-size: 1.5em;
        }

        .timer-value {
          font-size: 2.5em;
        }

        .control-btn {
          padding: 12px 30px;
          font-size: 1em;
        }

        .lesson-btn {
          min-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üéôÔ∏è English Speaking Practice</h1>
        <p class="subtitle">Luy·ªán N√≥i Ti·∫øng Anh - American English</p>
      </div>

      <div class="welcome-section">
        <h2>Ch√†o m·ª´ng b·∫°n! üëã</h2>
        <p>
          Ch∆∞∆°ng tr√¨nh luy·ªán n√≥i ti·∫øng Anh <strong>gi·ªçng M·ªπ</strong> s·∫Ω gi√∫p b·∫°n
          th·ª±c h√†nh tr·∫£ l·ªùi c√°c c√¢u h·ªèi. M·ªói c√¢u h·ªèi b·∫°n s·∫Ω c√≥
          <strong>50 gi√¢y</strong> ƒë·ªÉ tr·∫£ l·ªùi. H√£y l·∫Øng nghe c√¢u h·ªèi v√† tr·∫£ l·ªùi
          to b·∫±ng ti·∫øng Anh.
        </p>
        <p style="margin-top: 10px">
          <strong>H∆∞·ªõng d·∫´n:</strong> Ch·ªçn b√†i h·ªçc ‚Üí Ch·ªçn gi·ªçng ƒë·ªçc (∆∞u ti√™n
          gi·ªçng M·ªπ) ‚Üí Nh·∫•n Start ‚Üí L·∫Øng nghe v√† tr·∫£ l·ªùi m·ªói c√¢u h·ªèi.
        </p>
      </div>

      <div class="lesson-selector">
        <button class="lesson-btn" data-lesson="1">
          üìù B√ÄI 1: B·∫¢N TH√ÇN<br />
          <small>(6 c√¢u h·ªèi)</small>
        </button>
        <button class="lesson-btn" data-lesson="2">
          üíº B√ÄI 2: C√îNG VI·ªÜC<br />
          <small>(15 c√¢u h·ªèi)</small>
        </button>
      </div>

      <div class="practice-area">
        <div class="voice-controls">
          <div class="voice-control-group">
            <label>üîä Ch·ªçn gi·ªçng ƒë·ªçc (∆Øu ti√™n gi·ªçng M·ªπ üá∫üá∏):</label>
            <select id="voiceSelect">
              <option>ƒêang t·∫£i gi·ªçng ƒë·ªçc...</option>
            </select>
          </div>
          <div class="voice-control-group">
            <label>‚ö° T·ªëc ƒë·ªô ƒë·ªçc: <span id="speedValue">1.0x</span></label>
            <input
              type="range"
              id="speedControl"
              min="0.5"
              max="2"
              step="0.1"
              value="1"
            />
          </div>
        </div>

        <div class="progress-section">
          <div class="progress-info">
            <span>Ti·∫øn ƒë·ªô</span>
            <span id="progressText">0/0</span>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
        </div>

        <div class="status-indicator" id="statusIndicator"></div>

        <div class="question-display" id="questionDisplay">
          <div class="question-number" id="questionNumber"></div>
          <div class="question-text" id="questionText">
            Nh·∫•n Start ƒë·ªÉ b·∫Øt ƒë·∫ßu
          </div>
        </div>

        <div class="timer-display">
          <div class="timer-label">Th·ªùi gian c√≤n l·∫°i</div>
          <div class="timer-value" id="timerValue">50</div>
        </div>

        <div class="controls">
          <button class="control-btn btn-start" id="startBtn">‚ñ∂Ô∏è Start</button>
          <button class="control-btn btn-pause" id="pauseBtn" disabled>
            ‚è∏Ô∏è Pause
          </button>
          <button class="control-btn btn-stop" id="stopBtn" disabled>
            ‚èπÔ∏è Stop
          </button>
        </div>

        <div
          class="completion-message"
          id="completionMessage"
          style="display: none"
        >
          <h2>üéâ Xu·∫•t s·∫Øc!</h2>
          <p>B·∫°n ƒë√£ ho√†n th√†nh b√†i h·ªçc!</p>
          <button class="restart-btn" id="restartBtn">üîÑ L√†m l·∫°i</button>
        </div>
      </div>
    </div>

    <script>
      const lessons = {
        1: {
          title: "B·∫¢N TH√ÇN",
          questions: [
            "What's your name?",
            "How old are you?",
            "Where are you from?",
            "Where do you live?",
            "What do you do for a living?",
            "Where do you work?",
          ],
        },
        2: {
          title: "C√îNG VI·ªÜC",
          questions: [
            "Do you work or study?",
            "What do you do for a living?",
            "Where do you work?",
            "What's your department?",
            "How many people are there in your department?",
            "Are your colleagues friendly?",
            "Is your boss easy-going?",
            "What do you do at work?",
            "How many days off do you have a week?",
            "What days do you work?",
            "What time do you start work?",
            "What time do you get off work?",
            "Do you work the night shift?",
            "How far is it from your house to your workplace?",
            "How long does it take you to get to your workplace?",
          ],
        },
      };

      let currentLesson = null;
      let currentQuestionIndex = 0;
      let timer = null;
      let timeRemaining = 50;
      let isPaused = false;
      let isRunning = false;
      let synth = window.speechSynthesis;
      let voices = [];
      let sortedVoices = [];
      let currentUtterance = null;

      // Elements
      const lessonBtns = document.querySelectorAll(".lesson-btn");
      const practiceArea = document.querySelector(".practice-area");
      const questionNumber = document.getElementById("questionNumber");
      const questionText = document.getElementById("questionText");
      const timerValue = document.getElementById("timerValue");
      const progressBar = document.getElementById("progressBar");
      const progressText = document.getElementById("progressText");
      const statusIndicator = document.getElementById("statusIndicator");
      const startBtn = document.getElementById("startBtn");
      const pauseBtn = document.getElementById("pauseBtn");
      const stopBtn = document.getElementById("stopBtn");
      const completionMessage = document.getElementById("completionMessage");
      const restartBtn = document.getElementById("restartBtn");
      const voiceSelect = document.getElementById("voiceSelect");
      const speedControl = document.getElementById("speedControl");
      const speedValue = document.getElementById("speedValue");

      // Load and prioritize voices
      function loadVoices() {
        voices = synth.getVoices();

        // Filter English voices and categorize by priority
        const usVoices = [];
        const ukVoices = [];
        const otherEnVoices = [];

        voices.forEach((voice) => {
          if (voice.lang.startsWith("en-US")) {
            usVoices.push(voice);
          } else if (voice.lang.startsWith("en-GB")) {
            ukVoices.push(voice);
          } else if (voice.lang.startsWith("en")) {
            otherEnVoices.push(voice);
          }
        });

        // Combine in priority order: US -> UK -> Other
        sortedVoices = [...usVoices, ...ukVoices, ...otherEnVoices];

        // Populate select dropdown
        voiceSelect.innerHTML = "";

        if (sortedVoices.length === 0) {
          voiceSelect.innerHTML =
            "<option>No English voices available</option>";
        } else {
          sortedVoices.forEach((voice, index) => {
            const option = document.createElement("option");
            option.value = index;

            // Add badge based on voice type
            let badge = "";
            if (voice.lang.startsWith("en-US")) {
              badge = " üá∫üá∏ [Recommended]";
            } else if (voice.lang.startsWith("en-GB")) {
              badge = " üá¨üáß";
            }

            option.textContent = `${voice.name} (${voice.lang})${badge}`;

            // Auto-select first US voice (index 0 if available)
            if (index === 0) {
              option.selected = true;
            }

            voiceSelect.appendChild(option);
          });
        }
      }

      // Load voices when available
      if (synth.onvoiceschanged !== undefined) {
        synth.onvoiceschanged = loadVoices;
      }

      // Initial load
      setTimeout(loadVoices, 100);

      speedControl.addEventListener("input", (e) => {
        speedValue.textContent = e.target.value + "x";
      });

      // Lesson selection
      lessonBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          const lessonNum = parseInt(btn.dataset.lesson);
          selectLesson(lessonNum);
        });
      });

      function selectLesson(lessonNum) {
        currentLesson = lessons[lessonNum];
        currentQuestionIndex = 0;

        lessonBtns.forEach((btn) => {
          btn.classList.toggle(
            "active",
            parseInt(btn.dataset.lesson) === lessonNum
          );
        });

        practiceArea.classList.add("active");
        resetPractice();
        updateProgress();
      }

      function resetPractice() {
        stopTimer();
        synth.cancel();
        isRunning = false;
        isPaused = false;
        timeRemaining = 50;
        currentQuestionIndex = 0;

        questionText.textContent = "Nh·∫•n Start ƒë·ªÉ b·∫Øt ƒë·∫ßu";
        questionNumber.textContent = "";
        timerValue.textContent = "50";
        timerValue.classList.remove("warning");
        statusIndicator.style.display = "none";
        completionMessage.style.display = "none";

        startBtn.disabled = false;
        pauseBtn.disabled = true;
        stopBtn.disabled = true;

        updateProgress();
      }

      function updateProgress() {
        const total = currentLesson.questions.length;
        const current = currentQuestionIndex;
        const percentage = (current / total) * 100;

        progressBar.style.width = percentage + "%";
        progressText.textContent = `${current}/${total}`;
      }

      function speak(text) {
        return new Promise((resolve, reject) => {
          synth.cancel();

          currentUtterance = new SpeechSynthesisUtterance(text);

          // Use selected voice from prioritized list
          const selectedIndex = parseInt(voiceSelect.value);
          if (sortedVoices[selectedIndex]) {
            currentUtterance.voice = sortedVoices[selectedIndex];
          }

          currentUtterance.rate = parseFloat(speedControl.value);
          currentUtterance.pitch = 1;
          currentUtterance.volume = 1;

          currentUtterance.onend = resolve;
          currentUtterance.onerror = reject;

          synth.speak(currentUtterance);
        });
      }

      function showQuestion() {
        const question = currentLesson.questions[currentQuestionIndex];
        questionNumber.textContent = `C√¢u h·ªèi ${currentQuestionIndex + 1}/${
          currentLesson.questions.length
        }`;
        questionText.textContent = question;

        statusIndicator.style.display = "block";
        statusIndicator.className = "status-indicator status-speaking";
        statusIndicator.textContent = "üîä ƒêang ƒë·ªçc c√¢u h·ªèi...";

        speak(question)
          .then(() => {
            if (isRunning && !isPaused) {
              startTimer();
            }
          })
          .catch((error) => {
            console.error("Speech error:", error);
            if (isRunning && !isPaused) {
              startTimer();
            }
          });
      }

      function startTimer() {
        timeRemaining = 50;
        timerValue.textContent = timeRemaining;
        timerValue.classList.remove("warning");

        statusIndicator.className = "status-indicator status-waiting";
        statusIndicator.textContent =
          "‚è±Ô∏è Th·ªùi gian tr·∫£ l·ªùi - H√£y n√≥i c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n!";

        timer = setInterval(() => {
          if (!isPaused) {
            timeRemaining--;
            timerValue.textContent = timeRemaining;

            if (timeRemaining <= 10) {
              timerValue.classList.add("warning");
            }

            if (timeRemaining <= 0) {
              stopTimer();
              nextQuestion();
            }
          }
        }, 1000);
      }

      function stopTimer() {
        if (timer) {
          clearInterval(timer);
          timer = null;
        }
      }

      function nextQuestion() {
        currentQuestionIndex++;
        updateProgress();

        if (currentQuestionIndex >= currentLesson.questions.length) {
          completeLesson();
        } else {
          showQuestion();
        }
      }

      function completeLesson() {
        isRunning = false;
        stopTimer();
        synth.cancel();

        document.querySelector(".question-display").style.display = "none";
        document.querySelector(".timer-display").style.display = "none";
        document.querySelector(".controls").style.display = "none";
        statusIndicator.style.display = "none";
        completionMessage.style.display = "block";

        startBtn.disabled = false;
        pauseBtn.disabled = true;
        stopBtn.disabled = true;
      }

      // Control buttons
      startBtn.addEventListener("click", () => {
        if (!isRunning) {
          isRunning = true;
          isPaused = false;
          currentQuestionIndex = 0;

          document.querySelector(".question-display").style.display = "flex";
          document.querySelector(".timer-display").style.display = "block";
          document.querySelector(".controls").style.display = "flex";
          completionMessage.style.display = "none";

          startBtn.disabled = true;
          pauseBtn.disabled = false;
          stopBtn.disabled = false;

          updateProgress();
          showQuestion();
        }
      });

      pauseBtn.addEventListener("click", () => {
        if (isRunning) {
          isPaused = !isPaused;

          if (isPaused) {
            synth.pause();
            pauseBtn.textContent = "‚ñ∂Ô∏è Resume";
            statusIndicator.textContent = "‚è∏Ô∏è ƒê√£ t·∫°m d·ª´ng";
          } else {
            synth.resume();
            pauseBtn.textContent = "‚è∏Ô∏è Pause";
            if (timer) {
              statusIndicator.className = "status-indicator status-waiting";
              statusIndicator.textContent =
                "‚è±Ô∏è Th·ªùi gian tr·∫£ l·ªùi - H√£y n√≥i c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n!";
            } else {
              statusIndicator.className = "status-indicator status-speaking";
              statusIndicator.textContent = "üîä ƒêang ƒë·ªçc c√¢u h·ªèi...";
            }
          }
        }
      });

      stopBtn.addEventListener("click", () => {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën d·ª´ng b√†i h·ªçc?")) {
          resetPractice();
        }
      });

      restartBtn.addEventListener("click", () => {
        resetPractice();
      });
    </script>
  </body>
</html>
